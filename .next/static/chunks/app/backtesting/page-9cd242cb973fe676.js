(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[684],{5395:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Error:()=>M,Loading:()=>z,default:()=>I});var a=s(5155),r=s(2115),l=s(3109),n=s(9869),i=s(5690),c=s(2178),d=s(8979),o=s(1788),x=s(5339),m=s(646);let h=e=>{var t;let{onResults:s}=e,[h,u]=(0,r.useState)({startYear:2010,endYear:2024,initialInvestment:1e6,strategies:["equalWeightBuyHold","marketCapBuyHold","equalWeightRebalanced","marketCapRebalanced"]}),[g,p]=(0,r.useState)(!1),[y,b]=(0,r.useState)(!1),[j,f]=(0,r.useState)({current:0,total:0,step:""}),[N,v]=(0,r.useState)(null),[w,k]=(0,r.useState)(""),[S,B]=(0,r.useState)(""),[C,Y]=(0,r.useState)(""),A=(0,r.useRef)(null),R=async()=>{k(""),p(!0),b(!1),v(null);try{var e;let t;if(S.includes(",")){let e=S.trim().split("\n");t=e[0].toLowerCase().includes("ticker")?e.slice(1).map(e=>{let[t,s,a]=e.split(",").map(e=>e.trim());return{ticker:t,startDate:s,endDate:a||null}}):S.split(",").map(e=>({ticker:e.trim(),startDate:"".concat(h.startYear,"-01-01"),endDate:null}))}else if(C)t=C.split("\n").map(e=>({ticker:e.trim(),startDate:"".concat(h.startYear,"-01-01"),endDate:null})).filter(e=>e.ticker);else{f({current:1,total:10,step:"Loading S&P 500 stock data..."});let e=await fetch("/api/backtesting/sp500-stocks");t=(await e.json()).stocks}if(!t||0===t.length)throw Error("No stocks provided for backtesting");f({current:2,total:10,step:"Initializing backtest with ".concat(t.length," stocks...")});let a={stocks:t,startYear:h.startYear||2010,endYear:h.endYear||2024,initialInvestment:h.initialInvestment||1e6,strategies:h.strategies||["equalWeightBuyHold"]};A.current=new AbortController;let r=await fetch("/api/backtesting/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),signal:A.current.signal});if(!r.ok)throw Error("Backtest failed: ".concat(r.statusText));let l=null==(e=r.body)?void 0:e.getReader();if(!l)throw Error("No response stream");let n="";for(;;){let{done:e,value:t}=await l.read();if(e)break;let a=(n+=new TextDecoder().decode(t)).split("\n");for(let e of(n=a.pop()||"",a))if(e.trim())try{let t=JSON.parse(e);if("progress"===t.type)f(t.progress);else if("results"===t.type)v(t.results),null==s||s(t.results);else if("error"===t.type)throw Error(t.error)}catch(t){console.log("Non-JSON line:",e)}}}catch(e){e instanceof Error&&"AbortError"===e.name?k("Backtest was cancelled"):k(e instanceof Error?e.message:"Unknown error occurred")}finally{p(!1),b(!1),f({current:0,total:0,step:""})}},F=async()=>{if(N)try{let e=await fetch("/api/excel-export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({strategies:N.strategies,spyData:N.spyBenchmark.data,startYear:h.startYear,endYear:h.endYear,initialInvestment:h.initialInvestment})});if(!e.ok)throw Error("Export failed");let t=await e.blob(),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="portfolio_backtest_".concat(h.startYear,"_").concat(h.endYear,".xlsx"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a)}catch(e){k("Export failed: ".concat(e instanceof Error?e.message:"Unknown error"))}};return(0,a.jsx)("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)(l.A,{className:"h-8 w-8 text-blue-600"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Portfolio Backtesting"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Time Period"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Year"}),(0,a.jsx)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:h.startYear||2010,onChange:e=>u(t=>({...t,startYear:parseInt(e.target.value)})),children:Array.from({length:30},(e,t)=>1996+t).map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Year"}),(0,a.jsx)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:h.endYear||2024,onChange:e=>u(t=>({...t,endYear:parseInt(e.target.value)})),children:Array.from({length:30},(e,t)=>1996+t).map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Investment Amount"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Initial Investment"}),(0,a.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:h.initialInvestment||1e6,onChange:e=>u(t=>({...t,initialInvestment:parseInt(e.target.value)})),min:"1000",step:"1000"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["$",(h.initialInvestment||1e6).toLocaleString()]})]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Strategies to Test"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{id:"equalWeightBuyHold",name:"Equal Weight Buy & Hold",description:"Equal weights, no rebalancing"},{id:"marketCapBuyHold",name:"Market Cap Buy & Hold",description:"Market cap weights, no rebalancing"},{id:"equalWeightRebalanced",name:"Equal Weight Rebalanced",description:"Annual equal weight rebalancing"},{id:"marketCapRebalanced",name:"Market Cap Rebalanced",description:"Annual market cap rebalancing"}].map(e=>{var t;return(0,a.jsxs)("label",{className:"flex items-start space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[(0,a.jsx)("input",{type:"checkbox",checked:(null==(t=h.strategies)?void 0:t.includes(e.id))||!1,onChange:t=>((e,t)=>{u(s=>({...s,strategies:t?[...s.strategies||[],e]:(s.strategies||[]).filter(t=>t!==e)}))})(e.id,t.target.checked),className:"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]},e.id)})})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Stock Universe"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"radio",name:"stockSource",value:"sp500",checked:!S&&!C,onChange:()=>{B(""),Y("")},className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),(0,a.jsx)("span",{children:"S&P 500 Historical Constituents"})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"radio",name:"stockSource",value:"custom",checked:!!C,onChange:()=>Y("AAPL\nMSFT\nGOOGL\nAMZN\nTSLA"),className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),(0,a.jsx)("span",{children:"Custom Stock List"})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"radio",name:"stockSource",value:"upload",checked:!!S,onChange:()=>{},className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),(0,a.jsx)("span",{children:"Upload CSV"})]})]}),""!==C&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock Tickers (one per line)"}),(0,a.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:6,value:C,onChange:e=>Y(e.target.value),placeholder:"AAPL MSFT GOOGL AMZN TSLA"})]}),""===S&&""===C&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.A,{className:"h-5 w-5 text-gray-400"}),(0,a.jsx)("input",{type:"file",accept:".csv,.txt",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(!s)return;let a=new FileReader;a.onload=e=>{var t;B(null==(t=e.target)?void 0:t.result)},a.readAsText(s)},className:"text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>{b(!0)},disabled:y,className:"flex items-center gap-2 px-6 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 disabled:bg-gray-400",children:[(0,a.jsx)(c.A,{className:"h-5 w-5"}),"Pause"]}),(0,a.jsxs)("button",{onClick:()=>{A.current&&A.current.abort(),p(!1),b(!1)},className:"flex items-center gap-2 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700",children:[(0,a.jsx)(d.A,{className:"h-5 w-5"}),"Stop"]})]}):(0,a.jsxs)("button",{onClick:R,disabled:!(null==(t=h.strategies)?void 0:t.length),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:[(0,a.jsx)(i.A,{className:"h-5 w-5"}),"Run Backtest"]}),N&&(0,a.jsxs)("button",{onClick:F,className:"flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[(0,a.jsx)(o.A,{className:"h-5 w-5"}),"Download Excel"]})]}),g&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-blue-600 border-t-transparent"}),(0,a.jsx)("span",{className:"font-medium text-blue-900",children:"Running Backtest..."})]}),j.total>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2 mb-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(j.current/j.total*100,"%")}})}),(0,a.jsxs)("p",{className:"text-sm text-blue-700",children:[j.step," (",j.current,"/",j.total,")"]})]})]}),w&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"h-5 w-5 text-red-600"}),(0,a.jsx)("span",{className:"font-medium text-red-900",children:"Error"})]}),(0,a.jsx)("p",{className:"text-red-700 mt-1",children:w})]}),N&&(0,a.jsxs)("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(m.A,{className:"h-5 w-5 text-green-600"}),(0,a.jsx)("span",{className:"font-medium text-green-900",children:"Backtest Complete!"})]}),(0,a.jsxs)("div",{className:"text-sm text-green-700",children:[(0,a.jsxs)("p",{children:["✅ ",N.strategies.length," strategies completed"]}),(0,a.jsxs)("p",{children:["\uD83D\uDCCA Best strategy: ",N.summary.bestStrategy]}),(0,a.jsxs)("p",{children:["\uD83C\uDFAF Strategies beating SPY: ",N.summary.spyOutperformers.length]}),(0,a.jsx)("p",{className:"mt-2 font-medium",children:"Download the Excel file for detailed results and analysis."})]})]})]})})};var u=s(8500),g=s(9074),p=s(9037),y=s(6785),b=s(2713);function j(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"".concat((100*e).toFixed(t),"%")}let N=e=>{var t;let{results:s,startYear:n,endYear:i,initialInvestment:c}=e,[d,o]=(0,r.useState)((null==(t=s.strategies[0])?void 0:t.strategy)||""),[x,m]=(0,r.useState)("summary"),h=s.strategies.find(e=>e.strategy===d),N=i-n,v=e=>{let t=e.annualizedReturn-.02,s=Math.sqrt(Math.abs(e.totalReturn/N));return s>0?t/s:0};return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Backtesting Results"}),(0,a.jsxs)("p",{className:"text-gray-600",children:[n," - ",i," • ",j(c)," Initial Investment"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[(0,a.jsx)(g.A,{className:"h-4 w-4"}),N," years • ",s.strategies.length," strategies"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(p.A,{className:"h-5 w-5 text-green-600"}),(0,a.jsx)("span",{className:"font-medium text-green-900",children:"Best Strategy"})]}),(0,a.jsx)("p",{className:"font-bold text-lg text-green-900",children:s.summary.bestStrategy}),(0,a.jsx)("p",{className:"text-sm text-green-700",children:j(Math.max(...s.strategies.map(e=>e.endValue)))})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(y.A,{className:"h-5 w-5 text-blue-600"}),(0,a.jsx)("span",{className:"font-medium text-blue-900",children:"SPY Benchmark"})]}),(0,a.jsx)("p",{className:"font-bold text-lg text-blue-900",children:f(s.spyBenchmark.totalReturn)}),(0,a.jsx)("p",{className:"text-sm text-blue-700",children:j(s.spyBenchmark.endValue)})]}),(0,a.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(l.A,{className:"h-5 w-5 text-purple-600"}),(0,a.jsx)("span",{className:"font-medium text-purple-900",children:"Beat SPY"})]}),(0,a.jsxs)("p",{className:"font-bold text-lg text-purple-900",children:[s.summary.spyOutperformers.length,"/",s.strategies.length]}),(0,a.jsx)("p",{className:"text-sm text-purple-700",children:"strategies"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(b.A,{className:"h-5 w-5 text-gray-600"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"Execution"})]}),(0,a.jsxs)("p",{className:"font-bold text-lg text-gray-900",children:[(s.summary.executionTime/1e3).toFixed(1),"s"]}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:"processing time"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-6",children:["summary","detailed","holdings"].map(e=>(0,a.jsx)("button",{onClick:()=>m(e),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(x===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),"summary"===x&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Strategy Performance Summary"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full border border-gray-200 rounded-lg",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Strategy"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Final Value"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Return"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Annual Return"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"vs SPY"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sharpe Ratio"})]})}),(0,a.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[s.strategies.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer ".concat(d===e.strategy?"bg-blue-50":""),onClick:()=>o(e.strategy),children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.strategy})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-bold text-gray-900",children:j(e.endValue)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-medium ".concat(e.totalReturn>0?"text-green-600":"text-red-600"),children:f(e.totalReturn)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-medium ".concat(e.annualizedReturn>0?"text-green-600":"text-red-600"),children:f(e.annualizedReturn)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center gap-1 ".concat(e.endValue>s.spyBenchmark.endValue?"text-green-600":"text-red-600"),children:[e.endValue>s.spyBenchmark.endValue?(0,a.jsx)(l.A,{className:"h-5 w-5 text-green-600"}):(0,a.jsx)(u.A,{className:"h-5 w-5 text-red-600"}),(0,a.jsxs)("span",{className:"font-medium",children:[e.endValue>s.spyBenchmark.endValue?"+":"",f((e.endValue-s.spyBenchmark.endValue)/s.spyBenchmark.endValue)]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-gray-900 font-medium",children:v(e).toFixed(2)})})]},e.strategy)),(0,a.jsxs)("tr",{className:"bg-blue-50 border-t-2 border-blue-200",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-bold text-blue-900",children:"SPY Benchmark"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-bold text-blue-900",children:j(s.spyBenchmark.endValue)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-bold text-blue-900",children:f(s.spyBenchmark.totalReturn)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"font-bold text-blue-900",children:f(s.spyBenchmark.annualizedReturn)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-blue-700",children:"—"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-blue-900 font-bold",children:v(s.spyBenchmark).toFixed(2)})})]})]})]})})]}),"detailed"===x&&h&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:[h.strategy," - Detailed Analysis"]}),(0,a.jsx)("select",{value:d,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:s.strategies.map(e=>(0,a.jsx)("option",{value:e.strategy,children:e.strategy},e.strategy))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 mb-4",children:"Year-by-Year Performance"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full border border-gray-200 rounded-lg",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Portfolio Value"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Holdings"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Cash"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"YoY Return"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:h.yearlySnapshots.map((e,t)=>{let s=h.yearlySnapshots[t-1],r=s?(e.totalValue-s.totalValue)/s.totalValue:0;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:new Date(e.date).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:j(e.totalValue)}),(0,a.jsxs)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:[e.holdings.length," stocks"]}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:j(e.cash)}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium ".concat(r>=0?"text-green-600":"text-red-600"),children:t>0?f(r):"—"})]},e.date)})})]})})]})]}),"holdings"===x&&h&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:[h.strategy," - Holdings Breakdown"]}),(0,a.jsx)("select",{value:d,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:s.strategies.map(e=>(0,a.jsx)("option",{value:e.strategy,children:e.strategy},e.strategy))})]}),h.yearlySnapshots.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold text-gray-900 mb-4",children:["Final Holdings (",h.yearlySnapshots[h.yearlySnapshots.length-1].date,")"]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full border border-gray-200 rounded-lg",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Ticker"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Shares"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Value"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Weight"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:h.yearlySnapshots[h.yearlySnapshots.length-1].holdings.sort((e,t)=>t.value-e.value).slice(0,20).map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:e.ticker}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:e.shares.toLocaleString()}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:j(e.value)}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2 mr-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(Math.min(100*e.weight,100),"%")}})}),f(e.weight)]})})]},e.ticker))})]})}),h.yearlySnapshots[h.yearlySnapshots.length-1].holdings.length>20&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Showing top 20 of ",h.yearlySnapshots[h.yearlySnapshots.length-1].holdings.length," holdings"]})]})]})]})]})};var v=s(3540),w=s(3504),k=s(4754),S=s(6025),B=s(2071),C=s(7086),Y=s(4683),A=s(2366),R=s(3401),F=s(7800);let P=e=>{let{results:t,startYear:s,endYear:l,initialInvestment:n}=e,i=r.useMemo(()=>Array.from({length:l-s+1},(e,t)=>s+t).map(e=>{let a={year:e};t.strategies.forEach(t=>{let s=t.yearlySnapshots.find(t=>new Date(t.date).getFullYear()===e);a[t.strategy]=s?s.totalValue:null});let r=t.spyBenchmark.data.find(t=>new Date(t.date).getFullYear()===e);if(r){var l;let e=n/((null==(l=t.spyBenchmark.data.find(e=>new Date(e.date).getFullYear()===s))?void 0:l.adjustedPrice)||1);a["SPY Benchmark"]=e*r.adjustedPrice}return a}).filter(e=>Object.keys(e).length>1),[t,s,l,n]),c=r.useMemo(()=>{let e=t.strategies.map(e=>({strategy:e.strategy.replace(" Annually","").replace("Weighted","Cap"),totalReturn:100*e.totalReturn,annualizedReturn:100*e.annualizedReturn,finalValue:e.endValue}));return e.push({strategy:"SPY Benchmark",totalReturn:100*t.spyBenchmark.totalReturn,annualizedReturn:100*t.spyBenchmark.annualizedReturn,finalValue:t.spyBenchmark.endValue}),e.sort((e,t)=>t.finalValue-e.finalValue)},[t]),d={"Equal Weight Buy & Hold":"#3B82F6","Market Cap Weighted Buy & Hold":"#10B981","Equal Weight Rebalanced Annually":"#8B5CF6","Market Cap Weighted Rebalanced Annually":"#F59E0B","SPY Benchmark":"#EF4444"};return(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-6 space-y-8",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Strategy Comparison"}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Portfolio Value Over Time"}),(0,a.jsx)("div",{className:"h-96",children:(0,a.jsx)(v.u,{width:"100%",height:"100%",children:(0,a.jsxs)(w.b,{data:i,children:[(0,a.jsx)(k.d,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,a.jsx)(S.W,{dataKey:"year",stroke:"#666",tick:{fontSize:12}}),(0,a.jsx)(B.h,{stroke:"#666",tick:{fontSize:12},tickFormatter:e=>"$".concat((e/1e6).toFixed(1),"M")}),(0,a.jsx)(C.m,{content:(0,a.jsx)(e=>{let{active:t,payload:s,label:r}=e;return t&&s&&s.length?(0,a.jsxs)("div",{className:"bg-white p-3 border border-gray-300 rounded-lg shadow-lg",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"Year: ".concat(r)}),s.map((e,t)=>(0,a.jsx)("p",{style:{color:e.color},className:"text-sm",children:"".concat(e.dataKey,": ").concat(j(e.value))},t))]}):null},{})}),(0,a.jsx)(Y.s,{wrapperStyle:{fontSize:"12px"},iconType:"line"}),t.strategies.map(e=>(0,a.jsx)(A.N,{type:"monotone",dataKey:e.strategy,stroke:d[e.strategy]||"#666",strokeWidth:2,dot:!1,connectNulls:!1},e.strategy)),(0,a.jsx)(A.N,{type:"monotone",dataKey:"SPY Benchmark",stroke:d["SPY Benchmark"],strokeWidth:2,strokeDasharray:"5 5",dot:!1,connectNulls:!1})]})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Total Returns Comparison"}),(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(v.u,{width:"100%",height:"100%",children:(0,a.jsxs)(R.E,{data:c,layout:"horizontal",children:[(0,a.jsx)(k.d,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,a.jsx)(S.W,{type:"number",stroke:"#666",tick:{fontSize:11},tickFormatter:e=>"".concat(e.toFixed(0),"%")}),(0,a.jsx)(B.h,{type:"category",dataKey:"strategy",stroke:"#666",tick:{fontSize:11},width:120}),(0,a.jsx)(C.m,{formatter:e=>["".concat(e.toFixed(1),"%"),"Total Return"],labelStyle:{color:"#374151"}}),(0,a.jsx)(F.y,{dataKey:"totalReturn",fill:"#3B82F6",radius:[0,4,4,0]})]})})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Annualized Returns Comparison"}),(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(v.u,{width:"100%",height:"100%",children:(0,a.jsxs)(R.E,{data:c,layout:"horizontal",children:[(0,a.jsx)(k.d,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),(0,a.jsx)(S.W,{type:"number",stroke:"#666",tick:{fontSize:11},tickFormatter:e=>"".concat(e.toFixed(0),"%")}),(0,a.jsx)(B.h,{type:"category",dataKey:"strategy",stroke:"#666",tick:{fontSize:11},width:120}),(0,a.jsx)(C.m,{formatter:e=>["".concat(e.toFixed(1),"%"),"Annualized Return"],labelStyle:{color:"#374151"}}),(0,a.jsx)(F.y,{dataKey:"annualizedReturn",fill:"#10B981",radius:[0,4,4,0]})]})})})]})]}),(0,a.jsxs)("div",{className:"mt-8 bg-gray-50 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Key Insights"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"bg-green-100 border border-green-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-green-900 mb-2",children:"\uD83C\uDFC6 Best Performer"}),(0,a.jsx)("p",{className:"text-green-800 font-semibold",children:t.summary.bestStrategy}),(0,a.jsxs)("p",{className:"text-sm text-green-700",children:[j(Math.max(...t.strategies.map(e=>e.endValue)))," final value"]})]}),(0,a.jsxs)("div",{className:"bg-blue-100 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"\uD83C\uDFAF Beat SPY"}),(0,a.jsxs)("p",{className:"text-blue-800 font-semibold",children:[t.summary.spyOutperformers.length," of ",t.strategies.length," strategies"]}),(0,a.jsx)("p",{className:"text-sm text-blue-700",children:"outperformed the benchmark"})]}),(0,a.jsxs)("div",{className:"bg-purple-100 border border-purple-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-purple-900 mb-2",children:"\uD83D\uDCCA Return Range"}),(0,a.jsx)("p",{className:"text-purple-800 font-semibold",children:f((Math.max(...t.strategies.map(e=>e.endValue))-Math.min(...t.strategies.map(e=>e.endValue)))/Math.min(...t.strategies.map(e=>e.endValue)))}),(0,a.jsx)("p",{className:"text-sm text-purple-700",children:"difference between best and worst"})]})]}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Performance Summary"}),(0,a.jsx)("div",{className:"space-y-2 text-sm text-gray-700",children:t.strategies.map(e=>{let s=e.endValue>t.spyBenchmark.endValue,r=(e.endValue-t.spyBenchmark.endValue)/t.spyBenchmark.endValue*100;return(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-200",children:[(0,a.jsx)("span",{className:"font-medium",children:e.strategy}),(0,a.jsxs)("span",{className:"".concat(s?"text-green-600":"text-red-600"),children:[s?"+":"",r.toFixed(1),"% vs SPY"]})]},e.strategy)})})]}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-white border border-gray-200 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"\uD83D\uDCCB Methodology"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsxs)("li",{children:["• All strategies start with $",j(n)," on January 1, ",s]}),(0,a.jsx)("li",{children:"• Rebalanced strategies adjust holdings annually at year-start"}),(0,a.jsx)("li",{children:"• Buy & hold strategies only add new stocks when they join the index"}),(0,a.jsx)("li",{children:"• Transaction costs and taxes are not included in calculations"}),(0,a.jsx)("li",{children:"• Dividends are assumed to be reinvested (using adjusted prices)"}),(0,a.jsx)("li",{children:"• SPY benchmark assumes buy-and-hold of SPY ETF over the same period"})]})]})]})]})})};var D=s(5169),V=s(4355),E=s(6874),T=s.n(E);function I(){let[e,t]=(0,r.useState)(null),[s,n]=(0,r.useState)("form"),[i,c]=(0,r.useState)({startYear:2010,endYear:2024,initialInvestment:1e6});return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(T(),{href:"/",className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[(0,a.jsx)(D.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Back to Market Cap Fetcher"})]}),(0,a.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(l.A,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Portfolio Backtesting"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Compare investment strategies with historical S&P 500 data"})]})]})]}),e&&(0,a.jsx)("button",{onClick:()=>{t(null),n("form")},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"New Backtest"})]})})}),e&&(0,a.jsx)("div",{className:"bg-white border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-6",children:(0,a.jsxs)("nav",{className:"flex space-x-8",children:[(0,a.jsx)("button",{onClick:()=>n("form"),className:"py-4 px-2 border-b-2 font-medium text-sm transition-colors ".concat("form"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.A,{className:"h-4 w-4"}),"Configuration"]})}),(0,a.jsx)("button",{onClick:()=>n("results"),className:"py-4 px-2 border-b-2 font-medium text-sm transition-colors ".concat("results"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(b.A,{className:"h-4 w-4"}),"Results"]})}),(0,a.jsx)("button",{onClick:()=>n("comparison"),className:"py-4 px-2 border-b-2 font-medium text-sm transition-colors ".concat("comparison"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(V.A,{className:"h-4 w-4"}),"Comparison"]})})]})})}),(0,a.jsxs)("main",{className:"pb-12",children:[("form"===s||!e)&&(0,a.jsx)(h,{onResults:e=>{t(e),n("results")}}),"results"===s&&e&&(0,a.jsx)(N,{results:e,startYear:i.startYear,endYear:i.endYear,initialInvestment:i.initialInvestment}),"comparison"===s&&e&&(0,a.jsx)(P,{results:e,startYear:i.startYear,endYear:i.endYear,initialInvestment:i.initialInvestment})]}),(0,a.jsx)("footer",{className:"bg-white border-t mt-auto",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"About Portfolio Backtesting"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"This tool allows you to backtest different portfolio strategies using historical S&P 500 constituent data. Compare equal weight vs market cap weighted approaches, and buy & hold vs rebalanced strategies."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Features"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsx)("li",{children:"• Four distinct investment strategies"}),(0,a.jsx)("li",{children:"• Historical S&P 500 constituent data"}),(0,a.jsx)("li",{children:"• SPY benchmark comparison"}),(0,a.jsx)("li",{children:"• Excel export with detailed analytics"}),(0,a.jsx)("li",{children:"• Interactive charts and visualizations"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Important Disclaimer"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"This backtesting tool is for educational and research purposes only. Past performance does not guarantee future results. Transaction costs, taxes, and other factors are not included in these calculations."})]})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 mt-8 pt-8 text-center",children:(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Portfolio Backtesting Tool • Built with historical financial data •",new Date().getFullYear()]})})]})})]})}function z(){return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-2 border-blue-600 border-t-transparent mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Loading Portfolio Backtesting"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Initializing backtesting environment..."})]})})}function M(e){let{error:t,reset:s}=e;return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,a.jsx)("div",{className:"bg-red-100 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(l.A,{className:"h-8 w-8 text-red-600"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Something went wrong!"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"There was an error loading the backtesting page. Please try again."}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:s,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Try again"}),(0,a.jsx)(T(),{href:"/",className:"block w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Back to Market Cap Fetcher"})]}),!1]})})}},7314:(e,t,s)=>{Promise.resolve().then(s.bind(s,5395))}},e=>{e.O(0,[874,812,441,964,358],()=>e(e.s=7314)),_N_E=e.O()}]);